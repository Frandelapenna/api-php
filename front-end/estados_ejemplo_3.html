<!DOCTYPE html>
<html>
    <head>
        <title>Consumo de API de estados</title>
    </head>

    <body>
        <form>
            <label for="descripcion">Descripcion</label>
            <input type="text" id="descripcion" name="descripcion">
            <button type="button" id="btnGrabar" name="btnGrabar">Grabar</button>
        </form>
    </body>

    <script type="text/javascript">
        // Agrego el evento click del botón grabar.
        document.getElementById("btnGrabar").addEventListener("click", () => {
            // Si los datos del formulario son válido entonces, mando a grabar.
            if (validar_formulario()) {
                // Armo el array con los datos que le voy a enviar a la API.
                let data = {
                    "descripcion": document.getElementById("descripcion").value
                };

                // Incolo al API que permite insertar un registro en la base
                fetch('../apis/estados-api.php/insert', {
                    method: 'POST',
                    body: JSON.stringify(data),
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                    .then(data => {
                        // Verifico el estado de ejecución del API y
                        // muestro el mensaje que devuelve el API.
                        if(data.success) {
                            alert(data.values["mensaje"]);
                        }
                        else
                            alert(data.values["mensaje"]);
                    }).catch((error) => {
                        console.error(error);
                    });
            }
        });

        /**
         * Valido el formulario para que se ingrese la descripción obligatoriamente.
        */
        function validar_formulario() {
            if (document.getElementById("descripcion").value === "") {
                alert("Ingrese la descripción");
                document.getElementById("descripcion").focus();
                return false;
            }

            return true;
        }  

    </script>
</html>